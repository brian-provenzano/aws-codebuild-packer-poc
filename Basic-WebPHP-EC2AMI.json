{
  "_comment": "Create simple image PHP web using AmazonLinux 1",
  "variables": {
    "aws_region": "{{env `AWS_REGION`}}"
  },
  "builders": [{
    "type": "amazon-ebs",
    "region": "{{user `aws_region`}}",
    "instance_type": "t3.micro",
    "ssh_username": "ec2-user",
    "ami_name": "{{user `aws_aminame`}}-AMZNLinux1-{{timestamp}}",
    "source_ami_filter": {
      "filters": {
          "virtualization-type": "hvm",
          "name": "amzn-ami*-ebs",
          "root-device-type": "ebs"
      },
      "owners": ["137112412989", "591542846629", "801119661308", "102837901569", "013907871322", "206029621532", "286198878708", "443319210888"],
      "most_recent": true
  },
    "ami_description": "PHP/Node Web server : AmazonLinux : php71, nodejs, npm, drush, composer",
      "tags": {
        "Name": "{{user `aws_aminame`}}-AMZNLinux1",
        "OS_Version": "amazonlinux1",
        "Applications": "nodejs,npm,php,gulp,composer,drush",
        "NodeJSVersion": "10.x",
        "Purpose": "web",
        "BuildDate": "{{timestamp}}"
  }
  }],
  "provisioners": [
    {
      "type": "shell",
      "execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo '{{ .Path }}'",
      "script": "deploy-bootstrap.sh"
    }
  ]
}